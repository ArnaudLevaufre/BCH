\pagestyle{empty}
\makeatletter

\tikzset{add font/.code={\expandafter\def\expandafter\tikz@textfont\expandafter{\tikz@textfont#1}}}
\tikzset{port labels/.style={font=\sffamily\scriptsize}}

%
% Default style for components
%

\tikzset{every srr node/.style={draw,minimum width=2cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every pile node/.style={draw,minimum width=2cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every dff node/.style={draw,minimum width=1cm,minimum height=1.5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every syndrome node/.style={draw,minimum width=5cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every utsyndrome node/.style={draw,minimum width=5cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every ucsyndrome node/.style={draw,minimum width=5cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every counter node/.style={draw,minimum width=2cm,minimum height=4cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every lut node/.style={draw,minimum width=2cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every utlut node/.style={draw,minimum width=5cm,minimum height=5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every uclut node/.style={draw,minimum width=5cm,minimum height=5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every uccorr node/.style={draw,minimum width=5cm,minimum height=5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every utcorr node/.style={draw,minimum width=5cm,minimum height=5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every avalon node/.style={draw,minimum width=5cm,minimum height=5cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every decaddr node/.style={draw,minimum width=4cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}
\tikzset{every fifo node/.style={draw,minimum width=4cm,minimum height=2cm,inner sep=1mm,outer sep=0pt,cap=round,add font=\sffamily}}


%
% Shift right register
%

\pgfdeclareshape{srr}{
    % The 'minimum width' and 'minimum height' keys, not the content, determine
    % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
    % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports
    \anchor{Din}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{Ld}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.375\pgf@y%
    }
    \anchor{Shift}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }
    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.75\pgf@y%
    }
    \anchor{Dout}{
        \pgf@process{\northeast}%
        \pgf@y=0\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@srr@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{1ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont
        \tikz@textfont

        \pgf@anchor@srr@Din
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Din}}

        \pgf@anchor@srr@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{}}

        \pgf@anchor@srr@Dout
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Dout}}

        \pgf@anchor@srr@Ld
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Ld}}

        \pgf@anchor@srr@Shift
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Shift}}

        \endgroup
    }
}

%
% Pile
%

\pgfdeclareshape{pile}{
    % The 'minimum width' and 'minimum height' keys, not the content, determine
    % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
    % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports
    \anchor{In}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{Ld}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.25\pgf@y%
    }
    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.25\pgf@y%
    }
    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.75\pgf@y%
    }
    \anchor{Dout}{
        \pgf@process{\northeast}%
        \pgf@y=0\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@pile@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{1ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont
        \tikz@textfont

        \pgf@anchor@pile@In
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{In}}

        \pgf@anchor@pile@Ld
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Ld}}

        \pgf@anchor@pile@Raz
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Raz}}

        \pgf@anchor@pile@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLK}}

        \pgf@anchor@pile@Dout
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Dout}}

        \endgroup
    }
}

%
% Data Flip Flip (DFF) shape
%

\pgfdeclareshape{dff}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports
    \anchor{D}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=.5\pgf@y%
    }
    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.5\pgf@y%
    }
    \anchor{Q}{
        \pgf@process{\northeast}%
        \pgf@y=.5\pgf@y%
    }
    \anchor{Qn}{
        \pgf@process{\northeast}%
        \pgf@y=-.5\pgf@y%
    }

    \anchor{R}{
        \pgf@process{\northeast}%
        \pgf@x=0pt%
    }
    \anchor{S}{
        \pgf@process{\northeast}%
        \pgf@x=0pt%
        \pgf@y=-\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@dff@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{1ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@dff@D
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

        \pgf@anchor@dff@Q
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

        \pgf@anchor@dff@Qn
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

        \pgf@anchor@dff@R
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{R}

        \pgf@anchor@dff@S
        \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{S}

        \endgroup
    }
}


%
% External syndrome block
%

\pgfdeclareshape{syndrome}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports
    \anchor{Data}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=.75\pgf@y%
    }
    \anchor{Start}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=.25\pgf@y%
    }
    \anchor{Reset}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.25\pgf@y%
    }
    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.75\pgf@y%
    }

    \anchor{Syndrome}{
        \pgf@process{\northeast}%
        \pgf@y=.5\pgf@y%
    }
    \anchor{End}{
        \pgf@process{\northeast}%
        \pgf@y=-.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@syndrome@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@syndrome@Data
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Data [31:0]}}

        \pgf@anchor@syndrome@Start
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Start}}

        \pgf@anchor@syndrome@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Reset}}

        \pgf@anchor@syndrome@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLK}}

        \pgf@anchor@syndrome@Syndrome
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Syndrome [9:0]}}

        \pgf@anchor@syndrome@End
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{End}}

        \endgroup
    }
}

%
% External ut_syndrome block
%

\pgfdeclareshape{utsyndrome}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Data}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=.8\pgf@y%
    }

    \anchor{ld}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=.4\pgf@y%
    }

    \anchor{calc}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{clear}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.4\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.8\pgf@y%
    }

    \anchor{Syndrome}{
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@utsyndrome@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@utsyndrome@Data
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Data [31:0]}}

        \pgf@anchor@utsyndrome@ld
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Ld}}

        \pgf@anchor@utsyndrome@calc
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{calc}}

        \pgf@anchor@utsyndrome@clear
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{clear}}

        \pgf@anchor@utsyndrome@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLK}}

        \pgf@anchor@utsyndrome@Syndrome
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Syndrome [9:0]}}

        \endgroup
    }
}

%
% External uc_syndrome block
%

\pgfdeclareshape{ucsyndrome}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Start}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.5\pgf@y%
    }

    \anchor{Reset}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.75\pgf@y%
    }

    \anchor{End}{
        \pgf@process{\northeast}%
        \pgf@y=0.75\pgf@y%
    }

    \anchor{Calc}{
        \pgf@process{\northeast}%
        \pgf@y=-0.25\pgf@y%
    }

    \anchor{Ld}{
        \pgf@process{\northeast}%
        \pgf@y=0.25\pgf@y%
    }

    \anchor{Clear}{
        \pgf@process{\northeast}%
        \pgf@y=-0.75\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@ucsyndrome@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@ucsyndrome@Start
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Start}}

        \pgf@anchor@ucsyndrome@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Reset}}

        \pgf@anchor@ucsyndrome@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLK}}

        \pgf@anchor@ucsyndrome@End
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{End}}

        \pgf@anchor@ucsyndrome@Calc
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Calc}}

        \pgf@anchor@ucsyndrome@Ld
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Ld}}

        \pgf@anchor@ucsyndrome@Clear
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Clear}}

        \endgroup
    }
}

%
% Counter
%

\pgfdeclareshape{counter}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Data}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.71\pgf@y%
    }

    \anchor{Ld}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.42\pgf@y%
    }

    \anchor{Inc}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.14\pgf@y%
    }

    \anchor{Dec}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.14\pgf@y%
    }

    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.42\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.71\pgf@y%
    }

    \anchor{Q}{
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@counter@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@counter@Data
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Data}}

        \pgf@anchor@counter@Ld
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Ld}}

        \pgf@anchor@counter@Inc
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Inc}}

        \pgf@anchor@counter@Dec
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{Dec}}

        \pgf@anchor@counter@Raz
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{Raz}}

        \pgf@anchor@counter@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@counter@Q
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

        \endgroup
    }
}

%
% LUT
%

\pgfdeclareshape{lut}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Pone}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.5\pgf@y%
    }

    \anchor{Ptwo}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.5\pgf@y%
    }

    \anchor{Sone}{
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }
    \anchor{Stwo}{
        \pgf@process{\northeast}%
        \pgf@y=-0.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@lut@Pone
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{P1}}

        \pgf@anchor@lut@Ptwo
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{P2}}

        \pgf@anchor@lut@Sone
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{S1}}

        \pgf@anchor@lut@Stwo
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{S2}}

        \endgroup
    }
}

%
% UT Lut
%

\pgfdeclareshape{utlut}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Syndrome}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-.75\pgf@y%
    }

    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-0.75\pgf@x%
        \pgf@y=1\pgf@y%
    }

    \anchor{LdPtwo}{
        \pgf@process{\northeast}%
        \pgf@x=-0.5625\pgf@x%
        \pgf@y=1\pgf@y%
    }

    \anchor{LdSyndrome}{
        \pgf@process{\northeast}%
        \pgf@x=-0.375\pgf@x%
        \pgf@y=1\pgf@y%
    }

    \anchor{IncPone}{
        \pgf@process{\northeast}%
        \pgf@x=-0.1875\pgf@x%
        \pgf@y=1\pgf@y%
    }

    \anchor{IncPtwo}{
        \pgf@process{\northeast}%
        \pgf@x=0\pgf@x%
        \pgf@y=1\pgf@y%
    }

    \anchor{PoneMax}{
        \pgf@process{\northeast}%
        \pgf@x=0.1875\pgf@x%
        \pgf@y=1\pgf@y%
    }
    \anchor{PtwoMax}{
        \pgf@process{\northeast}%
        \pgf@x=0.375\pgf@x%
        \pgf@y=1\pgf@y%
    }
    \anchor{ErrOne}{
        \pgf@process{\northeast}%
        \pgf@x=0.5625\pgf@x%
        \pgf@y=1\pgf@y%
    }
    \anchor{ErrTwo}{
        \pgf@process{\northeast}%
        \pgf@x=0.75\pgf@x%
        \pgf@y=1\pgf@y%
    }
    \anchor{Pone}{
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }
    \anchor{Ptwo}{
        \pgf@process{\northeast}%
        \pgf@y=-0.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@utlut@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@utlut@Syndrome
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Syndrome}}

        \pgf@anchor@utlut@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@utlut@Pone
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{P1}}

        \pgf@anchor@utlut@Ptwo
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{P2}}

        \pgf@anchor@utlut@Raz
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Raz}}

        \pgf@anchor@utlut@LdPtwo
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_P2}}

        \pgf@anchor@utlut@LdSyndrome
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Syndrome}}

        \pgf@anchor@utlut@IncPone
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{IncP1}}

        \pgf@anchor@utlut@IncPtwo
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{IncP2}}

        \pgf@anchor@utlut@PoneMax
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{P1Max}}

        \pgf@anchor@utlut@PtwoMax
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{P2Max}}

        \pgf@anchor@utlut@ErrOne
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Err1}}

        \pgf@anchor@utlut@ErrTwo
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Err2}}

        \endgroup
    }
}

%
% UC Lut
%

\pgfdeclareshape{uclut}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Start}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.5\pgf@y%
    }

    \anchor{Reset}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.25\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{End}{
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }

    \anchor{Err}{
        \pgf@process{\northeast}%
        \pgf@y=0.25\pgf@y%
    }

    \anchor{LdErr}{
        \pgf@process{\northeast}%
        \pgf@y=0\pgf@y%
    }

    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-0.75\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{LdPtwo}{
        \pgf@process{\northeast}%
        \pgf@x=-0.5625\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{LdSyndrome}{
        \pgf@process{\northeast}%
        \pgf@x=-0.375\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{IncPone}{
        \pgf@process{\northeast}%
        \pgf@x=-0.1875\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{IncPtwo}{
        \pgf@process{\northeast}%
        \pgf@x=0\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{PoneMax}{
        \pgf@process{\northeast}%
        \pgf@x=0.1875\pgf@x%
        \pgf@y=-1\pgf@y%
    }
    \anchor{PtwoMax}{
        \pgf@process{\northeast}%
        \pgf@x=0.375\pgf@x%
        \pgf@y=-1\pgf@y%
    }
    \anchor{ErrOne}{
        \pgf@process{\northeast}%
        \pgf@x=0.5625\pgf@x%
        \pgf@y=-1\pgf@y%
    }
    \anchor{ErrTwo}{
        \pgf@process{\northeast}%
        \pgf@x=0.75\pgf@x%
        \pgf@y=-1\pgf@y%
    }


    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@uclut@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@uclut@Start
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Start}}

        \pgf@anchor@uclut@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Reset}}

        \pgf@anchor@uclut@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@uclut@End
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{End}}

        \pgf@anchor@uclut@Err
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Err}}

        \pgf@anchor@uclut@LdErr
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Ld\_Err}}

        \pgf@anchor@uclut@Raz
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Raz}}

        \pgf@anchor@uclut@LdPtwo
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_P2}}

        \pgf@anchor@uclut@LdSyndrome
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Syndrome}}

        \pgf@anchor@uclut@IncPone
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{IncP1}}

        \pgf@anchor@uclut@IncPtwo
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{IncP2}}

        \pgf@anchor@uclut@PoneMax
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{P1Max}}

        \pgf@anchor@uclut@PtwoMax
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{P2Max}}

        \pgf@anchor@uclut@ErrOne
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Err1}}

        \pgf@anchor@uclut@ErrTwo
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Err2}}

        \endgroup
    }
}

%
% UC Coor
%

\pgfdeclareshape{uccorr}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Start}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.75\pgf@y%
    }

    \anchor{Reset}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.375\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }


    \anchor{End}{
        \pgf@process{\northeast}%
        \pgf@y=0\pgf@y%
    }


    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-0.75\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{DecBuf}{
        \pgf@process{\northeast}%
        \pgf@x=-0.375\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{LdBuf}{
        \pgf@process{\northeast}%
        \pgf@x=0\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{LdCorr}{
        \pgf@process{\northeast}%
        \pgf@x=0.375\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    \anchor{Count}{
        \pgf@process{\northeast}%
        \pgf@x=0.75\pgf@x%
        \pgf@y=-1\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@uccorr@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@uccorr@Start
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Start}}

        \pgf@anchor@uccorr@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Reset}}

        \pgf@anchor@uccorr@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@uccorr@End
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{End}}



        \pgf@anchor@uccorr@Raz
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Raz}}

        \pgf@anchor@uccorr@DecBuf
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Dec\_Buf}}

        \pgf@anchor@uccorr@LdBuf
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Buf}}

        \pgf@anchor@uccorr@LdCorr
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Corr}}

        \pgf@anchor@uccorr@Count
        \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerxsep]{\rotatebox{90}{Count}}

        \endgroup
    }
}

%
% UT Coor
%

\pgfdeclareshape{utcorr}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    % Define anchors for signal ports

    \anchor{Data}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.25\pgf@y%
    }

    \anchor{Pone}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{Ptwo}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.25\pgf@y%
    }

    \anchor{Reset}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.5\pgf@y%
    }

    \anchor{CLK}{
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.75\pgf@y%
    }


    \anchor{DCorrOut}{
        \pgf@process{\northeast}%
        \pgf@y=-0.5\pgf@y%
    }


    \anchor{Raz}{
        \pgf@process{\northeast}%
        \pgf@x=-0.75\pgf@x%
    }

    \anchor{DecBuf}{
        \pgf@process{\northeast}%
        \pgf@x=-0.375\pgf@x%
    }

    \anchor{LdBuf}{
        \pgf@process{\northeast}%
        \pgf@x=-0\pgf@x%
    }

    \anchor{LdCorr}{
        \pgf@process{\northeast}%
        \pgf@x=0.375\pgf@x%
    }

    \anchor{Count}{
        \pgf@process{\northeast}%
        \pgf@x=0.75\pgf@x%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@utcorr@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@utcorr@Data
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Data}}

        \pgf@anchor@utcorr@Pone
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{P1}}

        \pgf@anchor@utcorr@Ptwo
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{P2}}

        \pgf@anchor@utcorr@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Reset}}

        \pgf@anchor@utcorr@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@utcorr@DCorrOut
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{D\_corr\_out}}

        \pgf@anchor@utcorr@Raz
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Raz}}

        \pgf@anchor@utcorr@DecBuf
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Dec\_Buf}}

        \pgf@anchor@utcorr@LdBuf
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Buf}}

        \pgf@anchor@utcorr@LdCorr
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Ld\_Corr}}

        \pgf@anchor@utcorr@Count
        \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerxsep]{\rotatebox{90}{Count}}

        \endgroup
    }
}

%
% Avalon
%


\pgfdeclareshape{avalon}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    \anchor{Addr}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{R}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.5357\pgf@y%
    }
    \anchor{W}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.3214\pgf@y%
    }
    \anchor{Din}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.1071\pgf@y%
    }
    \anchor{Dout}{ % out
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.1071\pgf@y%
    }
    \anchor{Irqn}{ % out
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.3214\pgf@y%
    }

    \anchor{Reset}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.5\pgf@y%
    }

    \anchor{CLK}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.75\pgf@y%
    }


    \anchor{AskIrq}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{InitFifo}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.5357\pgf@y%
    }
    \anchor{CorrOut}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.3214\pgf@y%
    }
    \anchor{CorrOutLd}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.1071\pgf@y%
    }
    \anchor{FifoOut}{ % out
        \pgf@process{\northeast}%
        \pgf@y=-0.1071\pgf@y%
    }
    \anchor{Words}{ % out
        \pgf@process{\northeast}%
        \pgf@y=-0.3214\pgf@y%
    }
    \anchor{Decode}{ % out
        \pgf@process{\northeast}%
        \pgf@y=-0.5357\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@avalon@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@avalon@Addr
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Addr}}

        \pgf@anchor@avalon@R
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

        \pgf@anchor@avalon@W
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{W}}

        \pgf@anchor@avalon@Din
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D\_in}}

        \pgf@anchor@avalon@Dout
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{D\_out}}

        \pgf@anchor@avalon@Irqn
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{Irq\_n}}

        \pgf@anchor@avalon@Reset
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{Reset}}

        \pgf@anchor@avalon@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}

        \pgf@anchor@avalon@AskIrq
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Ask\_irq}}

        \pgf@anchor@avalon@InitFifo
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{InitFifo}}

        \pgf@anchor@avalon@CorrOut
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Corr\_out}}

        \pgf@anchor@avalon@CorrOutLd
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Corr\_out\_ld}}

        \pgf@anchor@avalon@Decode
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Decode}}

        \pgf@anchor@avalon@Words
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Words}}

        \pgf@anchor@avalon@FifoOut
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{FifoOut}}

        \endgroup
    }
}


%
% Dec addr
%

\pgfdeclareshape{decaddr}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    \anchor{Addr}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }

    \anchor{Status}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.5\pgf@y%
    }
    \anchor{Control}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0\pgf@y%
    }
    \anchor{Data}{ % in
        \pgf@process{\northeast}%
        \pgf@y=-0.5\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@decaddr@Addr
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Addr}}


        \pgf@anchor@decaddr@Status
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Status}}

        \pgf@anchor@decaddr@Control
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Control}}

        \pgf@anchor@decaddr@Data
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Data}}

        \endgroup
    }
}

%
% Fifo
%

\pgfdeclareshape{fifo}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
    \savedanchor\northeast{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=0.5\pgf@x
        \pgf@y=0.5\pgf@y
    }
  % This is redundant, but makes some things easier:
    \savedanchor\southwest{%
        \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
        \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
        \pgf@x=-0.5\pgf@x
        \pgf@y=-0.5\pgf@y
    }
    % Inherit from rectangle
    \inheritanchorborder[from=rectangle]

    % Define same anchor a normal rectangle has
    \anchor{center}{\pgfpointorigin}
    \anchor{north}{\northeast \pgf@x=0pt}
    \anchor{east}{\northeast \pgf@y=0pt}
    \anchor{south}{\southwest \pgf@x=0pt}
    \anchor{west}{\southwest \pgf@y=0pt}
    \anchor{north east}{\northeast}
    \anchor{north west}{\northeast \pgf@x=-\pgf@x}
    \anchor{south west}{\southwest}
    \anchor{south east}{\southwest \pgf@x=-\pgf@x}
    \anchor{text}{
        \pgfpointorigin
        \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
        \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
        \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
    }

    \anchor{Din}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{Init}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0.375\pgf@y%
    }
    \anchor{W}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=0\pgf@y%
    }
    \anchor{R}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.375\pgf@y%
    }
    \anchor{CLK}{ % in
        \pgf@process{\northeast}%
        \pgf@x=-1\pgf@x%
        \pgf@y=-0.75\pgf@y%
    }

    \anchor{Dout}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.75\pgf@y%
    }
    \anchor{Level}{ % in
        \pgf@process{\northeast}%
        \pgf@y=0.25\pgf@y%
    }
    \anchor{Full}{ % in
        \pgf@process{\northeast}%
        \pgf@y=-0.25\pgf@y%
    }
    \anchor{Empty}{ % in
        \pgf@process{\northeast}%
        \pgf@y=-0.75\pgf@y%
    }

    % Draw the rectangle box and the port labels
    \backgroundpath{
        % Rectangle box
        \pgfpathrectanglecorners{\southwest}{\northeast}
        % Angle (>) for clock input
        \pgf@anchor@fifo@CLK
        \pgf@xa=\pgf@x \pgf@ya=\pgf@y
        \pgf@xb=\pgf@x \pgf@yb=\pgf@y
        \pgf@xc=\pgf@x \pgf@yc=\pgf@y
        \pgfmathsetlength\pgf@x{0.5ex} % size depends on font size
        \advance\pgf@ya by \pgf@x
        \advance\pgf@xb by \pgf@x
        \advance\pgf@yc by -\pgf@x
        \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
        \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfclosepath

        % Draw port labels
        \begingroup
        \tikzset{port labels} % Use font from this style
        \tikz@textfont

        \pgf@anchor@fifo@Din
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Din}}

        \pgf@anchor@fifo@Init
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Init}}

        \pgf@anchor@fifo@W
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{W}}

        \pgf@anchor@fifo@R
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

        \pgf@anchor@fifo@CLK
        \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{CLK}}


        \pgf@anchor@fifo@Dout
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Dout}}

        \pgf@anchor@fifo@Level
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Level}}

        \pgf@anchor@fifo@Full
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Full}}

        \pgf@anchor@fifo@Empty
        \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Empty}}

        \endgroup
    }
}

\makeatother
